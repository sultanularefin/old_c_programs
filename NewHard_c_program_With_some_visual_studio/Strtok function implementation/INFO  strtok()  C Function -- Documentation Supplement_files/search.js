function submitSimpleSearch(n,t){var u=function(){if(supportedSites&&supportedSites.length>0)return supportedSites[currentSiteIndex]},i=u(),r;if(i==null)return;n&&n.length!=0||(n=i.Url),r=i.ClickAction;switch(r){case ClickAction.FormSubmit:srch_setcookieval("lquery",UnicodeFixup(escape(jQuery.trim(t)))),StatsDotNet.eventCollectionId=SetLogCollectionBit(StatsDotNet.eventCollectionId,6),searchSubmit=1,$("#frmsrch").get(0).submit();break;case ClickAction.AjaxCall:return srch_setcookieval("lquery",UnicodeFixup(escape(jQuery.trim(t)))),window._gps.changeQuery({query:t}),!1;case ClickAction.Redirect:default:StatsDotNet.OptionCollectionId=SetLogCollectionBit(StatsDotNet.OptionCollectionId,33),StatsDotNet.targetUrl=n+t,t=window.encodeURIComponent?encodeURIComponent(t):OutputEncoder_EncodeUrl(t),document.location.href=n+t}return}function SubmitSearch(n){var u,i,t,r;elem=$("#frmaSrch").get(0).query,srch_setcookieval("lquery",UnicodeFixup(escape(jQuery.trim(elem.value))));if($("[name=catalog]").get(0)!=null)for(s=0;s<$("[name=catalog]").length;s++)if($("[name=catalog]").get(s).type!="select-one"){if($("[name=catalog]").get(s).checked){i=n.query.value,i=jQuery.trim(i),i=window.encodeURIComponent?encodeURIComponent(i):OutputEncoder_EncodeUrl(i);if($("[name=catalog]").get(s).value=="msc")return StatsDotNet.OptionCollectionId=SetLogCollectionBit(StatsDotNet.OptionCollectionId,33),u=mscomurl+i,document.location.href=u,!1;if($("[name=catalog]").get(s).value=="msn")return StatsDotNet.OptionCollectionId=SetLogCollectionBit(StatsDotNet.OptionCollectionId,33),u=msnurl+i,StatsDotNet.targetUrl=u,document.location.href=u,!1;srch_setcookieval("adcatalog",escape($("[name=catalog]").get(s).value))}}else t=$("[name=catalog]"),t&&t.options&&(r=t.options[t.selectedIndex].value,r!=""&&srch_setcookieval("adcatalog",r));else t=$("#catalog").get(0),t&&t.options&&(r=t.options[t.selectedIndex].value,r!=""&&srch_setcookieval("adcatalog",r));SaveSrchState(!0),StatsDotNet.eventCollectionId=SetLogCollectionBit(StatsDotNet.eventCollectionId,7),PageSubmit=1}function SaveSrchState(n){var t,r,u,f,e;if(PageSubmit===1)return;n===!0&&(t=$("#frmaSrch").get(0).query,srch_setcookieval("lquery",UnicodeFixup(escape(jQuery.trim(t.value))))),t=$("[name=catalog]"),t&&t.length&&t.type!="select-one"&&SaveRadioState(t,"catalog"),r="",u="";if(document.getElementsByName)for(t=document.getElementsByName("ast"),i=0;i<t.length;i++){if(t[i].disabled)continue;f=$("#"+t[i].value+"row").get(0),f&&(f.style.display=="block"||f.style.display=="")?t[i].checked?(r+="ad"+t[i].value+"=1|",u+=t[i].value+","):r+="ad"+t[i].value+"=0|":t[i].value=""}if(optElems){options=optElems.split("|");if(options!=null)for(i=0;i<options.length;i++)t=$("#"+options[i].toString()).get(0),t&&(e=$("#"+t.attributes._parentid.value).get(0),e.checked&&(t.checked?(r+="ad"+options[i]+"=1|",u+=options[i]+","):r+="ad"+options[i]+"=0|"))}srch_setcookieval("adresource",u),srch_setcookieval("adopt",r)}function InitSrch(){var i,n,r,t;null==$("#catalog").get(0)&&(n=document.createElement("span"),n.innerHTML="<input type='hidden' id='catalog' name='catalog' />",i=$("#frmsrch").get(0),i.appendChild(n)),n=$("#gsfx_bsrch_query").get(0),tval=$.trim($(n).val())!==""?$.trim($(n).val()):fetchcookieval("lquery"),tval&&tval!==""&&tval!=="blank"?(n.value=unescape(UnicodeFixup(jQuery.trim(tval))),setKeyBit(n)):$(n).bind("keypress paste",setKeyBit);if(avlCatalogs.length==0)return;r=$("#gsfx_bsrch_catsel a"),tval=fetchcookieval("adcatalog");if(tval){for(tval=unescape(tval),t=0;t<avlCatalogs.length;t++)if(avlCatalogs[t].Value==tval){$("#gsfx_cat_sel_div"+t).click();break}t==avlCatalogs.length&&ChangeCatSel(0)}else ChangeCatSel(0)}function SaveSimpleSearch(n){if(searchSubmit==1)return!1;var t=$("#gsfx_bsrch_query");return submitSimpleSearch(n,t.val()),!1}function InitASrch(){var t,r,u,o;$("#SearchDetails").css("display","block"),$("#divshowhide").css("display","block"),$("#showhide").toggle(function(){return $("#divshowhide").attr("class","hideMore"),$("#showhide > span").html(hideoptions),$("#arrowimg").attr("src",arrowImage.up),$(".catalogRadioList").css("margin-bottom","35px"),$(".catalogRadioList").show(),!1},function(){return $("#divshowhide").attr("class","showMore"),$("#showhide  > span").html(showoptions),$("#arrowimg").attr("src",arrowImage.down),$(".catalogRadioList").css("margin-bottom","0px"),$(".catalogRadioList").hide(),!1});var n,f=$("#frmaSrch").get(0),s=queryString.query?queryString.query:"",e=queryString.ast!==undefined?queryString.ast:"";n=f.query,$(n).bind("keydown",function(n){n.which===13&&$("#btnSubmit").trigger("click")}),s==""&&(t=fetchcookieval("lquery"),t?(n.value=unescape(UnicodeFixup(jQuery.trim(t))),setKeyBit(n)):$(n).bind("keypress paste",setKeyBit)),multicatalog=!1,n=f.catalog;if(n!=null){for(n.length&&n.type!="select-one"?(InitRadio(n,"catalog"),multicatalog=!0):InitSelect(n,"catalog","ad"),r=!1,i=0;i<n.length;i++)n[i].checked&&(r=!0);r||(n[0].checked=!0)}u=new OptionCookie;if(e=="")for(n=document.getElementsByName("ast"),j=0;j<n.length;j++){if(n[j].disabled)continue;t=u["ad"+n[j].value],t&&(n[j].checked=t==="0"?!1:!0)}else o=e.split(","),$("[name=ast]").each(function(){this.disabled===!1&&$(this).attr("checked",$.inArray(this.value,o)>-1?!0:!1)});if(optElems)for(opt=optElems.split("|"),j=0;j<opt.length;j++)n=$("#"+opt[j].toString()).get(0),n&&(t=u["ad"+opt[j]],t&&(n.checked=t=="0"?!1:!0))}function InitSelect(n,t,r){if(n!=null){tval=fetchcookieval(r+t),t=="SPID"&&(tval||(tval="global"));if(tval)for(i=0;i<n.options.length;i++)if(n.options[i].value==unescape(tval)){n.selectedIndex=i;break}}}function SelectRadio(n,t){if(t)for(i=0;i<n.length;i++)if(n[i].value==unescape(t)){n[i].checked=!0,n[i].click();break}}function InitRadioEx(n,t){tval=fetchcookieval("ad"+t);if(tval)for(i=0;i<n.length;i++)if(n[i].value==unescape(tval))if(!n[i].disabled){n[i].checked=!0,n[i].click();break}}function disableAll(n){if(n==null||n=="undefined"||n.tagName==null||n.tagName=="undefined")return;n.disabled=!0;for(var t=0;t<n.childNodes.length;t++)disableAll(n.childNodes[t])}function enableAll(n){if(n==null||n=="undefined"||n.tagName==null||n.tagName=="undefined")return;n.disabled=!1;for(var t=0;t<n.childNodes.length;t++)enableAll(n.childNodes[t])}function SearchLiveCatalog(n,t){var r,u,f,i,e;t==1&&(StatsDotNet.OptionCollectionId=SetLogCollectionBit(StatsDotNet.OptionCollectionId,53)),t==2&&(StatsDotNet.OptionCollectionId=SetLogCollectionBit(StatsDotNet.OptionCollectionId,54)),$("#lsc").get(0).value=t;if(t==2)return r=$("#catalog").get(0),r&&r.options&&(u=r.options[r.selectedIndex].value,u!=""&&srch_setcookieval("adcatalog",u)),e=$("#frmaSrch").get(0).query,i=$("#frmaSrch").get(0).query.value,i=jQuery.trim(i),i=window.encodeURIComponent?encodeURIComponent(i):OutputEncoder_EncodeUrl(i),f=msnurl+i,document.location.href=f,!1;SubmitSearch(n),$("#frmaSrch").get(0).submit()}function gsfx_bsrch_changeCatSelection(n){ChangeCatSel(n),srch_setcookieval("adcatalog",escape(avlCatalogs[n].Value))}function ChangeCatSel(n){$("#catalog").get(0).value=avlCatalogs[n].Value;if(n==currentCatSelIndx)return;$("#gsfx_cat_sel_div"+n).css({"font-weight":"bold",cursor:"default"}),$("#gsfx_cat_sel_img"+n).css({display:"block"}),$("#gsfx_cat_sel_div"+currentCatSelIndx).css({"font-weight":"normal",cursor:"pointer"}),$("#gsfx_cat_sel_img"+currentCatSelIndx).css({display:"none"}),currentCatSelIndx=n}function selectDropDownItem(n,t,i){for(var r=0;r<n.length;r++)if(n[r].value==t)return n[r].selected=!0,i!=null&&i(n),r;return-1}function CatalogOption_click(n){var r,i,e,f,u;try{for(r=$("input"),i=0;i<r.length;i++){e=r[i].attributes._parentid;if(e!=null&&e!="undefined"&&e!="")if(e.value==n.id)for(r[i].disabled=n.checked?!1:!0,f=r[i].parentNode.getElementsByTagName("a"),u=0;u<f.length;u++)enable_link(f[u]);else for(r[i].disabled=!0,f=r[i].parentNode.getElementsByTagName("a"),u=0;u<f.length;u++)disable_link(f[u])}}catch(o){}}function disable_link(n){if($(n).is(":visible")){var t=$(n).next("span[name=span_placeholder]");t.length?t.show():$(n).after('<span name="span_placeholder" style="color:gray">'+$.trim($(n).html())+"</span>"),$(n).hide()}}function enable_link(n){$(n).is(":hidden")&&($(n).next("span[name=span_placeholder]").hide(),$(n).show())}function SaveRadioState(n,t){for(i=0;i<n.length;i++)n[i].checked&&srch_setcookieval("ad"+t,escape(n[i].value))}function Site(n,t,i,r){return{Name:n,Url:t,Selected:i,ClickAction:r}}function Catalog(n,t,i){return{Name:n,Value:t,Selected:i}}function AddGpsSearchToSearchOptions(n,t){var i=!1,r;$(supportedSites).each(function(){this.Url===t&&(i=!0,this.Name=n)}),i||($(supportedSites).each(function(){this.Selected=!1}),supportedSites=$.merge([new Site(n,t,!0,ClickAction.AjaxCall)],supportedSites),currentSiteIndex=0),r=InitialSeachOptions(),$("#gsfx_bsrch_options_subcntr").replaceWith(r)}function removeGpsSearchFromSearchOptions(n){var t=!1,i=!1,r;supportedSites=$.map(supportedSites,function(r){if(r.Url===n){t=!0;return}return r.Selected&&(i=!0),r}),t&&(i||(supportedSites[0].Selected=!0),r=InitialSeachOptions(),$("#gsfx_bsrch_options_subcntr").replaceWith(r))}function InitialSeachOptions(){var i=document.createElement("DIV"),f,r,n,u,t,e;for(i.id="gsfx_bsrch_options_subcntr",f=document.createElement("DIV"),r=document.createElement("DIV"),r.id="gsfx_srchsitename_div",r.className="gsfx_srchsitename_cotnr",n=0;n<supportedSites.length;n++)u=r.cloneNode(!0),u.id+=n,u.innerHTML=supportedSites[n].Name,t=f.cloneNode(!0),e=n,$(t).bind("click",{index:e},ChangeSiteSelection),supportedSites[n].Selected?($(t).attr("class","TopSearchOptionsSelected"),ChangeFormAction(n)):$(t).attr("class","TopSearchOptionsDefault"),t.appendChild(u),i.appendChild(t);return $(i).width($("#gsfx_bsrch_divQuery").width()),i}function CreateSearchOptions(n,t){var e,i,r,f,u;optContainer=document.createElement("DIV"),optContainer.id="gsfx_bsrch_options",e=InitialSeachOptions(),optContainer.appendChild(e),i=$("html").css("direction")=="rtl",r=$("#gsfx_bsrch_bg_ie6").get(0),isIE6=$("#gsfx_bsrch_bg_ie6").length>0,isIE6&&(r.style.left=i?$("#gsfx_bsrch_bg").get(0).offsetLeft+4:$("#gsfx_bsrch_bg").get(0).offsetLeft-2,r.style.display="block"),f=$("#"+n).get(0),f?(f.appendChild(optContainer),$("#"+n+" > :first-child").css({"border-bottom":"0px","border-color":"#999999","margin-top":"0px"}),i&&$("#"+n+" > :first-child").css({"margin-right":"-1px"}),$("#"+n+" > :first-child").css({"background-color":"#ffffff"}),$("#"+n).css({"margin-left":"-1px",height:"0px"}),u=MS.Support.AC?MS.Support.AC.ACArrayEl("gsfx_bsrch_query"):null,u&&(u.options.handleResize=ResizeSiteOpts,u.options.acMinWidth=t)):($(optContainer).insertBefore("#gsfx_bsrch_query"),i?$(optContainer).css({position:"relative",top:$("#gsfx_bsrch_divQuery").get(0).offsetHeight+"px",float:"right"}):$(optContainer).css({top:$("#gsfx_bsrch_divQuery").get(0).offsetHeight+"px",left:"-1px"})),$("#gsfx_bsrch_query").bind("focus",function(n){HandleQueryFocus(n),$("#acListWrappergsfx_bsrch_query").show()}),$("#gsfx_bsrch_btnimg").live("focus",function(){$("#acListWrappergsfx_bsrch_query").show(),$("#gsfx_bsrch_options").show(),$("#gsfx_bsrch_options_subcntr :eq(currentSiteIndex)").show()}),$("#gsfx_bsrch_btnimg").live("blur",function(){$("#acListWrappergsfx_bsrch_query").hide()}),$("#gsfx_bsrch_query").bind("click.srchsiteopts",function(n){HandleQueryFocus(n),$("#gsfx_bsrch_query").unbind("click.srchsiteopts")}),$("#gsfx_bsrch_query").bind("keydown.srchsiteopts",function(n){HandleKeydown(n);if($("#acListWrappergsfx_bsrch_query :first-child").css("visibility")==="hidden"){var t=-1;if(n.which==40){t=currentSiteIndex+1;if(t>=supportedSites.length)return}else if(n.which==38){t=currentSiteIndex-1;if(t<0)return}t!=-1&&($("#gsfx_srchsitename_div"+t).parent().attr("class","TopSearchOptionsSelected"),$("#gsfx_srchsitename_div"+currentSiteIndex).parent().attr("class","TopSearchOptionsDefault"),supportedSites[currentSiteIndex].Selected=!1,supportedSites[t].Selected=!0,currentSiteIndex=t)}if(n.which===13)return SaveSimpleSearch()}),$(document).bind("click.srchsiteopts",function(n){SimpleSearchClickHandler(n)})}function SimpleSearchClickHandler(n){var t,r,i,u;if(!n||!n.target)return;t=n.target;if($(t).hasClass("gsfx_img_png"))return;r=$("#gsfx_bsrch_divQuery").get(0),i=t==r,i||(i=IsChild(t,r)),i?(HideLangSel(),$(optContainer).css({display:"block"})):$(optContainer).css({display:"none"});if(avlCatalogs.length==0)return;if(t==$("#gsfx_cat_sel").get(0))return;u=IsChild(t,$("#gsfx_cat_sel").get(0),3),u||HideLangSel()}function IsChild(n,t,i){var u;if(!n)return!1;u=!1,i||(i=6);var r=n.parentNode,f=0,e=!1;while(r&&i>f){if(r==t){u=!0;break}r=$(r).parent().get(0),f++}return u}function ResizeSiteOpts(n){optContainer.style.top=n.style.visibility!="hidden"&&n.childNodes.length>0?$(n).get(0).clientHeight+"px":0,n.style.visibility!="hidden"?$(optContainer).css({display:"block"}):$(document).get(0).activeElement!=$("#gsfx_bsrch_query").get(0)&&$(optContainer).css({display:"none"})}function HandleKeydown(n){if(n.keyCode==9)if($(optContainer).prev().get(0)==null||$(optContainer).prev().css("visibility")=="hidden"){$(optContainer).css({display:"none"});return}if(n.keyCode==13)return;HandleQueryFocus(n)}function HandleQueryFocus(n){if(n.type=="focus"&&prevElement==n.target)return;HideLangSel(),$(optContainer).css({display:"block"})}function ChangeSiteSelection(n){var t=n.data.index;ChangeFormAction(t);if(supportedSites[t].Selected)return;$("#gsfx_srchsitename_div"+t).parent().attr("class","TopSearchOptionsSelected"),$("#gsfx_srchsitename_div"+currentSiteIndex).parent().attr("class","TopSearchOptionsDefault"),supportedSites[currentSiteIndex].Selected=!1,supportedSites[t].Selected=!0,currentSiteIndex=t}function InitCatLangSel(){var i=$("#gsfx_cat_sel"),t=$("#gsfx_cat_sel_btn"),n=$("#gsfx_cat_sel_btn img");$panel=$("#gsfx_cat_sel_cntnr");if(t.length===0||$panel.length===0)return;if(avlCatalogs&&avlCatalogs.length<=1){$container.hide();return}t.click(function(t){$panel.css("top",n[0].height+"px"),$(optContainer).hide(),$panel.toggle(),SimpleSearchClickHandler(t)}),n.attr("hover-src")&&(n.attr("normal-src",n.attr("src")),t.hover(function(){n.attr("src",n.attr("hover-src"))},function(){n.attr("src",n.attr("normal-src"))})),$panel.width($("#gsfx_bsrch_query").parent().width()/2+t.width()+35),i.show()}function HideLangSel(){$panel=$("#gsfx_cat_sel_cntnr").hide()}function CallWebSearch(n,t){var i=$("#frmaSrch").get(0),r=i.query;if($.trim($(r).val()).length==0){StatsDotNet.OptionCollectionId=SetLogCollectionBit(StatsDotNet.OptionCollectionId,33),StatsDotNet.targetUrl=n,document.location.href=n;return}SaveSimpleSearch(t)}var clicked=!1,extraOp="",supportedSites=[],currentSiteIndex=0,avlCatalogs=[],currentCatSelIndx=-1,optContainer=null,isIE6=!1,prevElement=null,searchSubmit=0,Microsoft=window.Microsoft||{},ClickAction,gsfx_bsrch_InitCatSelection,ChangeFormAction;Microsoft.Support=Microsoft.Support||{},Microsoft.Support.GSS=Microsoft.Support.GSS||{},Microsoft.Support.GSS.GpsSearch=function(n,t){var r={gpsSearchCountPerPage:5,language:"en-us"},i=$.extend(!0,{},r,t);this.callService=function(t){var f="1-"+i.gpsSearchCountPerPage,r=parseInt(t),e,o,u;r>0&&(e=(r-1)*5+1,o=r*i.gpsSearchCountPerPage,f=e+"-"+o),$(".loading-panel",n).css("display","block"),$(".update-panel",n).css("display","none"),$(".error-panel",n).css("display","none"),u=window._wayfinder.getCurrentProduct(),$.ajax({url:"/GuidedProblemSolving/GuidedProblemSolvingService.svc/GetGPSPageContent",cache:!1,type:"get",dataType:"json",data:{query:$.param({query:$("#gsfx_bsrch_query").val()}),lang:i.language,modalityType:window._wayfinder.getCurrentModality().type,range:f,path:u?u.getPath():""},success:function(t){if(typeof t=="undefined"||t===null){$(".error-panel",n).css("display","block"),$(".loading-panel",n).css("display","none");return}$(n).parent().html(t.d)},error:function(){$(".error-panel",n).css("display","block"),$(".loading-panel",n).css("display","none");return}})}},ClickAction={Redirect:0,AjaxCall:1,FormSubmit:2},gsfx_bsrch_InitCatSelection=function(n,t){var f=unescape(fetchcookieval("adcatalog")),e=0,o=!1,u,r,i;if(f){u=$("#gsfx_bsrch_catsel").get(0);if(u){for(r=0;r<u.childNodes.length;r++){i=u.childNodes[r];if(i&&i.tagName&&i.getAttribute("catalog")){if(i.getAttribute("catalog")==f){i.className+=" gsfx_bsrch_highlight";try{MS.Support.AC.ACChangeCharStart(n,t.split(":")[e]),MS.Support.AC.ACSetLcid(n,f.split("=")[1])}catch(s){}o=!0}else i.className=i.className.replace(/( ?|^)gsfx_bsrch_highlight\b/gi,"");e++}}if(!o)for(r=0;r<u.childNodes.length;r++){i=u.childNodes[r];if(i&&i.tagName&&i.getAttribute("catalog")){i.className+=" gsfx_bsrch_highlight";return}}}}},ChangeFormAction=function(n){$("#frmsrch").attr("action",supportedSites[n].Url)};
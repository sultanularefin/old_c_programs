var Microsoft=window.Microsoft||{};Microsoft.Support=Microsoft.Support||{},Microsoft.Support.GSS=Microsoft.Support.GSS||{},Microsoft.Support.GSS.WayFinder=function(n,t){var s=Microsoft.Support.GSS.ScopeNodeType,o=Microsoft.Support.GSS.ScopeNode,u=this,l=$(this),c=$(n),ut={enable:!0,language:"en-us",isRTL:!1,path:"",isFullTopicPath:!1,topicKeys:[]},f=$.extend(!0,{},ut,t),a=$(".modalities li",c),e=$(".products ul:first > li.product-tile",c),rt=$(".products li.product-item",c),v=$("ul",e),y=a.filter(".selected"),nt=e.filter(".selected"),et=nt,h=null,d=new o(s.Root),i=null,r=null,tt=o.prototype.parsePath,ot=function(n){return tt(n).join("/")},g=function(n,t){var f=i,u;i=r=t.data("node"),w(),u=l.triggerHandler("productselect",[r,n])===!1,f!==i&&l.triggerHandler("scopechange",[i,f])===!1&&(u=!0),u&&n.preventDefault()},p=function(n){return{type:n.data("type"),rootPath:n.data("root-path")}},k=function(n){var t=n.data("node");return t instanceof o||(t=new o(s.Product,n.data("key"),$.trim(n.find("> a").text()),{seamId:n.data("seam-id"),productId:n.data("product-id")}),n.data("node",t)),t},b=function(){var t=[],n=[];return $.each(arguments,function(t,i){i&&($.isArray(i)?n=n.concat(i):n.push(i))}),$.each(n,function(n,i){i=$.trim(i),i&&$.each(i.split(/[\\\/]/),function(n,i){i=$.trim(i),i&&t.push(i)})}),"/"+(t.length>0?t.join("/")+"/":"")},w=function(){$.each(a,function(){var n=$(this),t=p(n);n.find("a").attr("href",b(t.rootPath,i?i.getPath():""))})},it=function(){$.each(rt,function(){var n=$(this);n.find("a").attr("href",b(h.rootPath,n.data("node").getPath()))})},ft=function(){h=p(y),d=new o(s.Root),r=null,e.each(function(){var n=$(this),t=k(n);d.addChildren(t),n.find("li.product-item").each(function(){var n=$(this),i=k(n);t.addChildren(i)}),r===null&&n.is(".selected")&&(r=n.find("li.product-item.selected").data("node")||t)}),i=r,i&&$.isArray(f.topicKeys)&&($.each(f.topicKeys,function(n,t){if(t){var r=new o(s.Topic,t);r.setParent(i,!0),i=r}else return!1}),i.get("type")===s.Topic&&(i._props={leaf:f.isFullTopicPath})),$("a",a).click(function(n){var t,i;if(!f.enable)return!1;n.preventDefault(),t=$(this).parent("li"),y[0]!==t[0]&&(a.not(t).removeClass("selected"),t.addClass("selected"),h=p(t),l.trigger("modalityselect",[h,n]),y=t,it(),i=t.data("products-head-title"),i&&$(".products .head-title",c).html(i))}),$("> a",e).click(function(n){if(!f.enable)return!1;var i=$(this).parent("li"),t=i.find("> ul");t.length>0?(t.is(":visible")?t.hide():(v.not(t).hide(),t.show(),window.setTimeout(function(){$(document).one("click",function(){t.hide()})},100)),n.preventDefault()):(e.not(i).removeClass("selected"),v.not(t).hide(),i.addClass("selected"),g(n,i))}),v.each(function(){var n=$(this);if(n.is(":visible"))$(document).one("click",function(){n.hide()})}),$("li > a",e).click(function(n){if(!f.enable)return!1;var i=$(this).parent("li"),t=i.parent("ul"),r=t.parent("li");t.hide(),e.not(r).removeClass("selected"),v.not(t).hide(),r.addClass("selected"),g(n,i)});c.on("keypress","a",function(n){n.which===13&&$(this).click()});$(document).on("get-instances",function(n,t,i){i=$.isFunction(i)?i:$.isFunction(t)?t:null,t=$.isArray(t)?t:[],(i===null||i(u)===!0)&&t.push(u)})};ft(),u.enable=function(n){f.enable=n!==!1},u.getCt=function(){return c},u.getCurrentModality=function(){return h?$.extend({},h):null},u.getCurrentScope=function(){return i},u.getCurrentProduct=function(){return r},u.changeScope=function(n){var t,u,f;if(r&&n instanceof o){t=n.findParentByType(s.Product,!0),u=null;if(t===n&&t.getPath()===r.getPath())u=r;else{if(t!==r)if(t.getPath()===r.getPath())r.removeChildren(r.findChildrenByType(s.Topic)),r.addChildren(t.get("children"));else return!1;u=n}return i!==u&&(f=i,i=u,w(),l.trigger("scopechange",[i,f])),!0}return!1}},Microsoft.Support.GSS.ScopeNode=function(n,t,i,r,u){var f=this;$.extend(f,{_type:parseInt(n,10),_key:t?$.trim(t).toLowerCase():"",_name:$.trim(i),_props:$.isPlainObject(r)?r:{}}),f.addChildren(u)},$.extend(Microsoft.Support.GSS.ScopeNode.prototype,{_type:null,_key:null,_name:"",_props:{},_parent:null,_children:null,_filterScopeNodes:function(n){var i=this.constructor,t;if(n){if(n instanceof i)return n;if($.isArray(n))return t=[],$.each(n,function(n,r){r instanceof i&&t.push(r)}),t}return null},parsePath:function(n){var t=[];return typeof n=="string"&&n&&$.each(n.split(/[\\\/]/),function(n,i){i=$.trim(i),i&&t.push(i.toLowerCase())}),t},addChildren:function(n){var t=this;n=t._filterScopeNodes(n),n&&($.isArray(t._children)||(t._children=[]),$.each($.isArray(n)?n:[n],function(n,i){if($.inArray(i,t._children)===-1){var r=i.get("parent");r&&r!==t&&r.removeChildren(i),t._children.push(i),i.setParent(t,!0)}}))},removeChildren:function(n){var t=this;$.each($.isArray(n)?n:[n],function(n,i){var r=$.inArray(i,t._children);r>-1&&(t._children.splice(r,1),i.setParent(null))})},clearChildren:function(){this._children=[]},findChildren:function(n,t){var r=this,i;return t=t===!0,i=[],$.isFunction(n)&&r._children&&$.each(r._children,function(r,u){if(n(u)){i.push(u);if(t)return!1}}),i},findChildrenByType:function(n,t){return this.findChildren(function(t){return t.get("type")===n},t)},findChildByKey:function(n){var t=this.findChildren(function(t){return t.get("key")===n},!0);return t.length>0?t[0]:null},findChildByPath:function(n,t,i){var f=this,u=$.isArray(n)?n:f.parsePath(n),r,e;if(i===!0){if(u[0]!==f.key)return null;u=u.slice(1)}return r=f,e=0,$.each(u,function(n,i){var u=r.findChildByKey(i);if(u)r=u;else return t===!0&&(r=null),!1}),r},findParents:function(n,t,i){var f=this,u,r;i=i===!0,u=[];if($.isFunction(n)){r=t===!0?f:f._parent;while(r){if(n(r)){u.push(r);if(i)break}r=r._parent}}return u},findParentByType:function(n,t){var i=this.findParents(function(t){return t.get("type")===n},t,!0);return i.length>0?i[0]:0},get:function(n){var i=this,t=i["_"+n];if(t===undefined){t=i["_"+$.trim(n).toLowerCase()];if(t===undefined)return null}return $.isPlainObject(t)?$.extend({},t):$.isArray(t)?t.concat():t},setParent:function(n,t){var i=this;n=i._filterScopeNodes(n);if(i._parent===n)return;i._parent&&(i._parent.removeChildren(i),i._parent=null),n&&(i._parent=n,t!==!0&&n.addChildren(i))},getPathNodes:function(n){var t=this,i;return n===!0&&t._type===Microsoft.Support.GSS.ScopeNodeType.Root?[]:(i=t._parent?t._parent.getPathNodes(n):[],i.push(t),i)},getPath:function(){var n=this,t=n._parent?n._parent.getPath():"";return(t?t+"/":"")+n._key}}),Microsoft.Support.GSS.ScopeNodeType={Root:0,Product:1,Topic:2};
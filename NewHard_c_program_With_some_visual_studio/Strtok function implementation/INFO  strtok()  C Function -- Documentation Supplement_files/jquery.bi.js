(function(n){n.bi={dataConsumers:[],dataRetrievers:[],dataManipulators:[],isInitialized:function(){return this._isInitialized},loadEnabled:function(){return arguments.length<1||typeof arguments[0]!="boolean"||(this._loadEnabled=arguments[0]),this._loadEnabled},ignoreAttr:function(t){if(typeof t=="string"&&n.trim(t)!="")n.inArray(t,this._ignoreAttr)==-1&&this._ignoreAttr.push(t);else if(typeof t=="object")for(var i=0;i<t.length;i++)t[i]=n.trim(t[i]),n.inArray(t[i],this._ignoreAttr)==-1&&this._ignoreAttr.push(t[i])},ignoreTextClass:function(t){var r,i;if(typeof t=="string"&&n.trim(t)!="")for(r=t.split(/\s+/),i=0;i<r.length;i++)n.inArray(r[i],this._ignoreTextClass)==-1&&this._ignoreTextClass.push(r[i])},baseData:function(){return arguments.length<1||typeof arguments[0]!="object"||n.extend(this._baseData,this._objectNametoLower(arguments[0])),this._baseData},baseLoadData:function(){return arguments.length<1||typeof arguments[0]!="object"||n.extend(this._baseLoadData,this._objectNametoLower(arguments[0])),this._baseLoadData},baseLinkData:function(){return arguments.length<1||typeof arguments[0]!="object"||n.extend(this._baseLinkData,this._objectNametoLower(arguments[0])),this._baseLinkData},_objectNametoLower:function(n){var i={},t;for(t in n)i[t.toLowerCase()]=n[t];return i},init:function(t){var r,i;if(this.isInitialized())return;this._isInitialized=!0,this._ns=this.getNamespacePrefix("urn:schemas-microsoft-com:mscom:bi"),this.ignoreAttr(this._ns+":track"),r=window.attachEvent?"click":"mousedown",n("a, area").live(r,n.proxy(function(t){var u=!0,e=n(t.currentTarget),i=e.attr(n.bi._ns+":track"),f,r;i=i?i.toLowerCase():i,i&&(i==="true"||i==="false")?u=i=="true":(f=e.parents(":not(table)").filter(function(){var t=n(this).attr(n.bi._ns+":track");return t=t?t.toLowerCase():t,t&&(t==="true"||t==="false")?!0:!1}),f.length&&(u=n(f[0]).attr(n.bi._ns+":track").toLowerCase()=="true")),u&&(r=t.target,r.tagName.toLowerCase()=="area"&&(r=n("img[usemap='#"+n(r).parent("map").attr("name")+"']").get(0)),this.linkClick(t.currentTarget,r))},this));for(i in this.dataRetrievers)try{this.dataRetrievers[i].init()}catch(u){}for(i in this.dataConsumers)try{this.dataConsumers[i].init(t[i])}catch(u){}this.loadEnabled()&&n(n.proxy(this.recordLoad,this))},record:function(t){var i;t=n.extend({},this._baseData,t);for(i in this.dataManipulators)try{this.dataManipulators[i].preRecord(t)}catch(r){}for(i in this.dataConsumers)try{this.dataConsumers[i].record(t)}catch(r){}},recordLoad:function(t){var i;t==n&&(t={}),t=n.extend({},this._baseData,this._baseLoadData,t);for(i in this.dataRetrievers)try{n.extend(t,this.dataRetrievers[i].getLoadData())}catch(r){}for(i in this.dataManipulators)try{this.dataManipulators[i].preRecordLoad(t)}catch(r){}for(i in this.dataConsumers)try{this.dataConsumers[i].recordLoad(t)}catch(r){}},linkClick:function(n,t){this.record(this.getLinkData(n,t))},getLinkData:function(t,i){var r=n.extend({},this._baseData,this._baseLinkData),u;for(u in this.dataRetrievers)try{n.extend(r,this.dataRetrievers[u].getLinkData(t,i))}catch(f){}return r},getAttrData:function(t,i){var f={},r,o,h,s,c,l,e,u,a;if(jQuery&&t instanceof jQuery){for(h=t,s=0,c=h.length;s<c;s++)for(e=h.get(s).attributes,u=0,l=e.length;u<l;u++)r=e.item(u),o=r.name.toLowerCase(),o.indexOf(n.bi._ns+":")===0&&(i||n.inArray(o,this._ignoreAttr)<0)&&(index=o.substring(3,r.name.length),f[index]==undefined&&(f[index]=[]),n.inArray(r.value,f[index])<0&&f[index].push(r.value));for(u in f)f[u]=f[u].join(";")}else for(e=t.attributes,u=0,a=e.length;u<a;u++)r=e.item(u),r.name.indexOf(n.bi._ns+":")===0&&(i||n.inArray(r.name,this._ignoreAttr)<0)&&(f[r.name.toLowerCase().substring(3,r.name.length)]=r.value);return f},getText:function(t){var u=n(t).html(),i=n("<div>"+u+"</div>"),r;return this._ignoreTextClass.length>0&&(r="."+this._ignoreTextClass.join(",."),i.find(r).remove()),n.trim(i.text())},mapData:function(n,t){var u,i,r,f;if(!t)return!1;u={};for(i in t){for(u[i]="",r=0,f=t[i].length;r<f;r++)if(t[i][r].str!==undefined)u[i]+=t[i][r].str;else if(t[i][r].bi&&n&&n[t[i][r].bi]!==undefined){switch(t[i][r].bi){case"uripath":n[t[i][r].bi]==""||n[t[i][r].bi]==null||n[t[i][r].bi]==undefined?n[t[i][r].bi]="/":n[t[i][r].bi].substring(0,1)!="/"&&(n[t[i][r].bi]="/"+n[t[i][r].bi]);break;case"uriquery":(n[t[i][r].bi]==""||n[t[i][r].bi]==null||n[t[i][r].bi]==undefined)&&(n[t[i][r].bi]="?")}u[i]+=n[t[i][r].bi]}u[i]==""&&delete u[i]}return u},isInteractionTypeValid:function(n,t){return n&&t?t.interactionTypeMap?!n.interactiontype||t.interactionTypeMap[n.interactiontype]!=undefined:!1:!1},getNamespacePrefix:function(t){var u,r,i;if(document.namespaces)for(u=document.namespaces,i=0;i<u.length;i++)if(u[i].urn==t)return u[i].name;for(r=n("html").get(0).attributes,i=0;i<r.length;i++)if(r[i].value==t)if(r[i].name.indexOf("xmlns:")==0)return r[i].name.substring(r[i].name.indexOf(":")+1)},_isInitialized:!1,_ns:"bi",_loadEnabled:!0,_ignoreAttr:[],_ignoreTextClass:[],_baseData:{},_baseLoadData:{interactiontype:0},_baseLinkData:{interactiontype:2}}})(jQuery);